<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TrapSweeper: Duel</title>
    <style>
        :root {
            /* Renk Paleti */
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --p1-primary: #ff4757; /* Tuzak√ßƒ± Kƒ±rmƒ±zƒ±sƒ± */
            --p1-dark: #2f3542;
            --p2-primary: #2ed573; /* √á√∂z√ºc√º Ye≈üili */
            --p2-secondary: #3742fa;
            --cell-hidden: #3a3a3a;
            --cell-revealed: #b0bec5;
            --mine-color: #ff4757;
            --flag-color: #ffa502;
            --grid-gap: 4px;
        }

        * {
            box-sizing: border-box;
            user-select: none; /* Metin se√ßimini engelle */
            -webkit-user-select: none;
            touch-action: manipulation; /* √áift tƒ±klama zoom'u engelle */
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Ekran Y√∂netimi */
        .screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            padding: 20px;
            transition: opacity 0.3s ease;
        }

        .screen.active {
            display: flex;
        }

        h1, h2 {
            margin-bottom: 10px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        p {
            color: #aaa;
            text-align: center;
            margin-bottom: 20px;
        }

        /* Butonlar */
        button {
            padding: 15px 30px;
            font-size: 1.2rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.1s, filter 0.2s;
            margin: 5px;
        }

        button:active {
            transform: scale(0.95);
        }

        .btn-primary { background-color: var(--p2-primary); color: #000; }
        .btn-danger { background-color: var(--p1-primary); color: #fff; }
        .btn-action { width: 100%; max-width: 300px; margin-top: 15px; }

        /* Faz 0: Ayarlar */
        .setting-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .size-btn {
            background-color: var(--cell-hidden);
            color: white;
            padding: 10px 20px;
        }
        .size-btn.selected {
            background-color: var(--p2-secondary);
            border: 2px solid white;
        }

        /* Oyun Alanƒ± */
        #game-container {
            display: grid;
            gap: var(--grid-gap);
            background-color: #222;
            padding: 10px;
            border-radius: 10px;
            max-width: 95vw;
            max-height: 60vh;
            /* Grid template JS ile ayarlanacak */
        }

        .cell {
            background-color: var(--cell-hidden);
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            aspect-ratio: 1; /* Kare olmasƒ± i√ßin */
            transition: background-color 0.2s;
        }

        /* Oyuncu 1 G√∂r√ºn√ºm√º */
        .p1-mode .cell:hover { background-color: #444; }
        .p1-mode .cell.has-mine {
            background-color: var(--mine-color);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }

        /* Oyuncu 2 G√∂r√ºn√ºm√º */
        .p2-mode .cell.revealed {
            background-color: var(--cell-revealed);
            color: #333;
            cursor: default;
        }
        
        .p2-mode .cell.flagged {
            background-color: var(--cell-hidden);
        }
        .p2-mode .cell.flagged::after {
            content: "üö©";
            font-size: 1.2rem;
        }

        .p2-mode .cell.exploded {
            background-color: var(--mine-color) !important;
            animation: shake 0.5s;
        }
        .p2-mode .cell.exploded::after {
            content: "üí£";
        }

        /* Sayƒ±lar i√ßin renkler */
        .val-1 { color: blue; }
        .val-2 { color: green; }
        .val-3 { color: red; }
        .val-4 { color: darkblue; }
        .val-5 { color: brown; }
        .val-6 { color: teal; }
        .val-7 { color: black; }
        .val-8 { color: gray; }

        /* Ara√ß √áubuƒüu (Oyuncu 2) */
        .toolbar {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 500px;
            margin-bottom: 10px;
            background: #222;
            padding: 10px;
            border-radius: 8px;
        }

        .toggle-mode {
            flex: 1;
            margin: 0 5px;
            padding: 15px;
            background-color: #444;
            color: #fff;
            border: 2px solid transparent;
        }
        
        .toggle-mode.active {
            border-color: var(--p2-primary);
            background-color: #333;
        }

        /* Sonu√ß Ekranƒ± Overlay */
        #result-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        #result-title { font-size: 2.5rem; margin-bottom: 20px; }
        .win { color: var(--p2-primary); }
        .lose { color: var(--p1-primary); }

        /* Animasyonlar */
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }

        /* Responsive Ayarlar */
        @media (min-width: 768px) {
            #game-container {
                gap: 6px;
                padding: 20px;
            }
            .cell { font-size: 1.5rem; }
        }
    </style>
</head>
<body>

    <div id="screen-setup" class="screen active">
        <h1 style="color: var(--p2-primary);">TRAPSWEEPER: DUEL</h1>
        <p>Ters Y√ºz Edilmi≈ü Mayƒ±n Tarlasƒ±</p>
        
        <h3>Izgara Boyutu Se√ßin</h3>
        <div class="setting-group">
            <button class="size-btn selected" onclick="selectSize(8)">8x8</button>
            <button class="size-btn" onclick="selectSize(10)">10x10</button>
            <button class="size-btn" onclick="selectSize(12)">12x12</button>
        </div>

        <button class="btn-primary btn-action" onclick="startGame()">OYUNU BA≈ûLAT</button>
    </div>

    <div id="screen-p1" class="screen p1-mode">
        <h2 style="color: var(--p1-primary);">OYUNCU 1: TUZAK√áI</h2>
        <p>Mayƒ±nlarƒ± yerle≈ütirmek i√ßin karelere dokun.</p>
        
        <div class="toolbar" style="justify-content: center; color: var(--p1-primary);">
            <span id="mine-counter">0</span> / <span id="max-mine-counter">0</span> Mayƒ±n
        </div>

        <div id="grid-p1"></div>

        <button class="btn-danger btn-action" onclick="finishSetting()">HAZIR (TUZAKLARI KUR)</button>
    </div>

    <div id="screen-handover" class="screen">
        <h2>Cƒ∞HAZI DEVRET</h2>
        <p style="font-size: 1.2rem; padding: 20px;">L√ºtfen tableti <strong>OYUNCU 2</strong>'ye (√á√∂z√ºc√º) ver.</p>
        <div style="font-size: 3rem; margin: 30px;">ü§´</div>
        <button class="btn-primary btn-action" onclick="startSolving()">BEN HAZIRIM (OYUNCU 2)</button>
    </div>

    <div id="screen-p2" class="screen p2-mode">
        <h2 style="color: var(--p2-primary);">OYUNCU 2: √á√ñZ√úC√ú</h2>
        
        <div class="toolbar">
            <button id="btn-dig" class="toggle-mode active" onclick="setMode('dig')">‚õèÔ∏è KAZ (DIG)</button>
            <button id="btn-flag" class="toggle-mode" onclick="setMode('flag')">üö© BAYRAK</button>
        </div>
        
        <div id="grid-p2"></div>
    </div>

    <div id="result-overlay">
        <h1 id="result-title">OYUN Bƒ∞TTƒ∞</h1>
        <p id="result-desc"></p>
        <button class="btn-primary" onclick="resetGame()">YENƒ∞DEN OYNA</button>
    </div>

    <script>
        // Oyun Durum Deƒüi≈ükenleri
        let gridSize = 8;
        let totalCells = 64;
        let maxMines = 0;
        let mines = []; // Mayƒ±nlarƒ±n indekslerini tutar
        let gridState = []; // 0: kapalƒ±, 1: a√ßƒ±k, 2: bayraklƒ±
        let gameActive = false;
        let currentMode = 'dig'; // 'dig' veya 'flag'
        let revealedCount = 0;

        // Ayarlar
        function selectSize(size) {
            gridSize = size;
            totalCells = size * size;
            document.querySelectorAll('.size-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
        }

        // Faz 1'e Ge√ßi≈ü
        function startGame() {
            maxMines = Math.floor(totalCells * 0.20); // %20 Kuralƒ±
            mines = [];
            
            // Ekran deƒüi≈ütir
            switchScreen('screen-p1');
            
            // UI G√ºncelle
            document.getElementById('mine-counter').innerText = '0';
            document.getElementById('max-mine-counter').innerText = maxMines;
            
            // Grid olu≈ütur (P1 i√ßin)
            createGrid('grid-p1', handleP1Click);
        }

        // Grid Olu≈üturucu
        function createGrid(containerId, clickHandler) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            // CSS Grid Style
            container.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
            
            // H√ºcre boyutu hesaplama (responsive olmasƒ± i√ßin)
            // Mobil ekranlarda geni≈üliƒüe, tabletlerde y√ºksekliƒüe g√∂re sƒ±ƒüdƒ±r
            
            for (let i = 0; i < totalCells; i++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                cell.dataset.index = i;
                cell.addEventListener('click', () => clickHandler(i, cell));
                container.appendChild(cell);
            }
        }

        // Faz 1: Mayƒ±n Yerle≈ütirme Mantƒ±ƒüƒ±
        function handleP1Click(index, cellElement) {
            const mineIndex = mines.indexOf(index);
            
            if (mineIndex > -1) {
                // Mayƒ±nƒ± kaldƒ±r
                mines.splice(mineIndex, 1);
                cellElement.classList.remove('has-mine');
            } else {
                // Mayƒ±n ekle (Limit kontrol√º)
                if (mines.length < maxMines) {
                    mines.push(index);
                    cellElement.classList.add('has-mine');
                } else {
                    // Animasyon ile uyar (Titre≈üim vs eklenebilir)
                    alert("Maksimum mayƒ±n limitine ula≈ütƒ±n!");
                }
            }
            document.getElementById('mine-counter').innerText = mines.length;
        }

        // Faz 1 Biti≈ü Kontrol√º
        function finishSetting() {
            if (mines.length < 3) {
                alert("Oyunun zevkli olmasƒ± i√ßin en az 3 mayƒ±n yerle≈ütirmelisin!");
                return;
            }
            switchScreen('screen-handover');
        }

        // Faz 3: Oyuna Ba≈ülama
        function startSolving() {
            gridState = new Array(totalCells).fill(0); // Her ≈üeyi sƒ±fƒ±rla
            revealedCount = 0;
            gameActive = true;
            setMode('dig'); // Varsayƒ±lan mod

            switchScreen('screen-p2');
            createGrid('grid-p2', handleP2Click);
        }

        // P2 Mod Se√ßimi
        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.toggle-mode').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn-${mode}`).classList.add('active');
        }

        // Faz 3: Oyun Mantƒ±ƒüƒ±
        function handleP2Click(index, cellElement) {
            if (!gameActive) return;
            
            // Eƒüer h√ºcre zaten a√ßƒ±ksa i≈ülem yapma
            if (gridState[index] === 1) return;

            if (currentMode === 'flag') {
                toggleFlag(index, cellElement);
            } else {
                // Bayraklƒ± yere kazma vurulamaz
                if (gridState[index] === 2) return;
                dig(index, cellElement);
            }
        }

        function toggleFlag(index, cellElement) {
            if (gridState[index] === 0) {
                gridState[index] = 2; // Bayrakla
                cellElement.classList.add('flagged');
            } else if (gridState[index] === 2) {
                gridState[index] = 0; // Bayraƒüƒ± kaldƒ±r
                cellElement.classList.remove('flagged');
            }
        }

        function dig(index, cellElement) {
            // Mayƒ±na bastƒ± mƒ±?
            if (mines.includes(index)) {
                gameOver(false, index);
                return;
            }

            // G√ºvenli b√∂lgeyi a√ß
            revealCell(index);
            
            // Kazanma kontrol√º
            if (revealedCount === totalCells - mines.length) {
                gameOver(true);
            }
        }

        // Flood Fill (Bo≈üluklarƒ± Otomatik A√ßma) Algoritmasƒ±
        function revealCell(index) {
            const cell = document.querySelector(`#grid-p2 .cell[data-index='${index}']`);
            if (!cell || gridState[index] === 1 || gridState[index] === 2) return;

            gridState[index] = 1; // A√ßƒ±ldƒ± olarak i≈üaretle
            revealedCount++;
            cell.classList.add('revealed');
            cell.classList.remove('flagged'); // Varsa bayraƒüƒ± sil

            const neighborCount = countNeighborMines(index);

            if (neighborCount > 0) {
                cell.innerText = neighborCount;
                cell.classList.add(`val-${neighborCount}`);
            } else {
                // Kom≈üu mayƒ±n yoksa (0 ise), etrafƒ±ndakileri de a√ß
                const neighbors = getNeighbors(index);
                neighbors.forEach(nIndex => revealCell(nIndex));
            }
        }

        // Matematiksel Hesaplamalar
        function getCoordinates(index) {
            return { r: Math.floor(index / gridSize), c: index % gridSize };
        }

        function getIndex(r, c) {
            if (r < 0 || r >= gridSize || c < 0 || c >= gridSize) return -1;
            return r * gridSize + c;
        }

        function getNeighbors(index) {
            const { r, c } = getCoordinates(index);
            const neighbors = [];
            
            for (let dr = -1; dr <= 1; dr++) {
                for (let dc = -1; dc <= 1; dc++) {
                    if (dr === 0 && dc === 0) continue;
                    const nIndex = getIndex(r + dr, c + dc);
                    if (nIndex !== -1) neighbors.push(nIndex);
                }
            }
            return neighbors;
        }

        function countNeighborMines(index) {
            const neighbors = getNeighbors(index);
            return neighbors.filter(n => mines.includes(n)).length;
        }

        // Oyun Biti≈üi
        function gameOver(player2Won, explosionIndex = -1) {
            gameActive = false;
            const resultOverlay = document.getElementById('result-overlay');
            const title = document.getElementById('result-title');
            const desc = document.getElementById('result-desc');

            // T√ºm mayƒ±nlarƒ± g√∂ster
            mines.forEach(idx => {
                const cell = document.querySelector(`#grid-p2 .cell[data-index='${idx}']`);
                cell.classList.add('exploded');
                if (idx === explosionIndex) {
                    cell.style.border = "2px solid white"; // Patlayanƒ± vurgula
                }
            });

            setTimeout(() => {
                resultOverlay.style.display = 'flex';
                if (player2Won) {
                    title.innerText = "TEBRƒ∞KLER!";
                    title.className = 'win';
                    desc.innerText = "√á√∂z√ºc√º (Player 2) t√ºm g√ºvenli b√∂lgeleri temizledi!";
                } else {
                    title.innerText = "PATLADINIZ!";
                    title.className = 'lose';
                    desc.innerText = "Tuzak√ßƒ± (Player 1) kazandƒ±!";
                }
            }, 1000); // Patlamayƒ± g√∂rmek i√ßin 1 saniye bekle
        }

        // Yardƒ±mcƒ± Fonksiyonlar
        function switchScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function resetGame() {
            document.getElementById('result-overlay').style.display = 'none';
            switchScreen('screen-setup');
        }

    </script>
</body>
</html>
